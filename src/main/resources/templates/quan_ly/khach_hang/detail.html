

<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Khách hàng</title>

    <!-- Favicon -->
    <link rel="shortcut icon" href="/assets/images/Shoes6cop.png"/>
    <link rel="stylesheet" href="/assets/css/backend-plugin.min.css">
    <link rel="stylesheet" href="/assets/css/backend.css?v=1.0.0">
    <link rel="stylesheet" href="/assets/vendor/@fortawesome/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="/assets/vendor/line-awesome/dist/line-awesome/css/line-awesome.min.css">
    <link rel="stylesheet" href="/assets/vendor/remixicon/fonts/remixicon.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular-route.min.js"></script>
</head>

<body ng-app="myAngularJs" ng-controller="myController">
<!-- loader Start -->
<div id="loading">
    <div id="loading-center">
    </div>
</div>
<!-- loader END -->
<!-- Wrapper Start -->
<div class="wrapper">
    <div class="iq-sidebar  sidebar-default ">
        <div class="iq-sidebar-logo d-flex align-items-center justify-content-between">
            <a href="../backend/index.html" class="header-logo">
                <img src="/api/read-file-by-img-url/Shoes6cop.png" class="img-fluid rounded-normal light-logo"
                     alt="logo"><h5 class="logo-title light-logo ml-3">SHOES 6</h5>
            </a>
            <div class="iq-menu-bt-sidebar ml-0">
                <i class="las la-bars wrapper-menu"></i>
            </div>
        </div>
        <div class="data-scrollbar" data-scroll="1">
            <nav class="iq-sidebar-menu">
                <ul id="iq-sidebar-toggle" class="iq-menu">
                    <li class="">
                        <a href="/admin/thong-ke/index" class="svg-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                 class="bi bi-speedometer2" viewBox="0 0 16 16">
                                <path d="M8 4a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4M3.732 5.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707M2 10a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 10m9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5m.754-4.246a.39.39 0 0 0-.527-.02L7.547 9.31a.91.91 0 1 0 1.302 1.258l3.434-4.297a.39.39 0 0 0-.029-.518z"/>
                                <path fill-rule="evenodd"
                                      d="M0 10a8 8 0 1 1 15.547 2.661c-.442 1.253-1.845 1.602-2.932 1.25C11.309 13.488 9.475 13 8 13c-1.474 0-3.31.488-4.615.911-1.087.352-2.49.003-2.932-1.25A8 8 0 0 1 0 10m8-7a7 7 0 0 0-6.603 9.329c.203.575.923.876 1.68.63C4.397 12.533 6.358 12 8 12s3.604.532 4.923.96c.757.245 1.477-.056 1.68-.631A7 7 0 0 0 8 3"/>
                            </svg>
                            <span class="ml-4">Thống kê</span>
                        </a>
                    </li>
                    <li class="">
                        <a href="/ban-hang-tai-quay" class="svg-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                 class="bi bi-cash-stack" viewBox="0 0 16 16">
                                <path d="M1 3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1zm7 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/>
                                <path d="M0 5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1zm3 0a2 2 0 0 1-2 2v4a2 2 0 0 1 2 2h10a2 2 0 0 1 2-2V7a2 2 0 0 1-2-2z"/>
                            </svg>
                            <span class="ml-4">Bán hàng tại quầy</span>
                        </a>
                    </li>
                    <li class="">
                        <a href="/hoa-don/hien-thi" class="svg-icon">
                            <svg class="svg-icon" id="p-dash7" width="20" height="20" xmlns="http://www.w3.org/2000/svg"
                                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                 stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            <span class="ml-4">Quản lý đơn hàng</span>
                        </a>
                    </li>
                    <li class=" ">
                        <a href="#product" class="collapsed" data-toggle="collapse" aria-expanded="false">
                            <svg class="svg-icon" id="p-dash2" width="20" height="20" xmlns="http://www.w3.org/2000/svg"
                                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                 stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="9" cy="21" r="1"></circle>
                                <circle cx="20" cy="21" r="1"></circle>
                                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                            </svg>
                            <span class="ml-4">Quản lý sản phẩm</span>
                            <svg class="svg-icon iq-arrow-right arrow-active" width="20" height="20"
                                 xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="10 15 15 20 20 15"></polyline>
                                <path d="M4 4h7a4 4 0 0 1 4 4v12"></path>
                            </svg>
                        </a>
                        <ul id="product" class="iq-submenu collapse" data-parent="#iq-sidebar-toggle">
                            <li class="">
                                <a href="/admin/san-pham/index">
                                    <i class="las la-minus"></i><span>Sản phẩm</span>
                                </a>
                            </li>
                            <li class="">
                                <a href="/admin/de-giay/index-de-giay">
                                    <i class="las la-minus"></i><span>Đế giày</span>
                                </a>
                            </li>
                            <li class="">
                                <a href="/admin/loai-giay/index-loai-giay">
                                    <i class="las la-minus"></i><span>Loại giày</span>
                                </a>
                            </li>
                            <li class="">
                                <a href="/admin/thuong-hieu/index-thuong-hieu">
                                    <i class="las la-minus"></i><span>Thương hiệu</span>
                                </a>
                            </li>
                            <li class="">
                                <a href="/admin/chat-lieu/index-chat-lieu">
                                    <i class="las la-minus"></i><span>Chất liệu</span>
                                </a>
                            </li>
                            <li class="">
                                <a href="/admin/kich-co/index-kich-co">
                                    <i class="las la-minus"></i><span>Kích cỡ</span>
                                </a>
                            </li>
                            <li class="">
                                <a href="/admin/mau-sac/index-mau-sac">
                                    <i class="las la-minus"></i><span>Màu sắc</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class=" ">
                        <a href="#category" class="collapsed" data-toggle="collapse" aria-expanded="false">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                 class="bi bi-ticket-perforated" viewBox="0 0 16 16">
                                <path d="M4 4.85v.9h1v-.9zm7 0v.9h1v-.9zm-7 1.8v.9h1v-.9zm7 0v.9h1v-.9zm-7 1.8v.9h1v-.9zm7 0v.9h1v-.9zm-7 1.8v.9h1v-.9zm7 0v.9h1v-.9z"/>
                                <path d="M1.5 3A1.5 1.5 0 0 0 0 4.5V6a.5.5 0 0 0 .5.5 1.5 1.5 0 1 1 0 3 .5.5 0 0 0-.5.5v1.5A1.5 1.5 0 0 0 1.5 13h13a1.5 1.5 0 0 0 1.5-1.5V10a.5.5 0 0 0-.5-.5 1.5 1.5 0 0 1 0-3A.5.5 0 0 0 16 6V4.5A1.5 1.5 0 0 0 14.5 3zM1 4.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 .5.5v1.05a2.5 2.5 0 0 0 0 4.9v1.05a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-1.05a2.5 2.5 0 0 0 0-4.9z"/>
                            </svg>
                            <span class="ml-4">Giảm giá</span>
                            <svg class="svg-icon iq-arrow-right arrow-active" width="20" height="20"
                                 xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="10 15 15 20 20 15"></polyline>
                                <path d="M4 4h7a4 4 0 0 1 4 4v12"></path>
                            </svg>
                        </a>
                        <ul id="category" class="iq-submenu collapse" data-parent="#iq-sidebar-toggle">
                            <li class="">
                                <a href="/admin/giam-gia-san-pham/index">
                                    <i class="las la-minus"></i><span>Đợt giảm giá</span>
                                </a>
                            </li>
                            <li class="">
                                <a href="/admin/phieu-giam-gia/index">
                                    <i class="las la-minus"></i><span>Phiếu giảm giá</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class=" ">
                        <a href="#category2" class="collapsed" data-toggle="collapse" aria-expanded="false">
                            <svg class="svg-icon" id="p-dash8" width="20" height="20" xmlns="http://www.w3.org/2000/svg"
                                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                 stroke-linecap="round" stroke-linejoin="round">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                            <span class="ml-4">Tài khoản</span>
                            <svg class="svg-icon iq-arrow-right arrow-active" width="20" height="20"
                                 xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="10 15 15 20 20 15"></polyline>
                                <path d="M4 4h7a4 4 0 0 1 4 4v12"></path>
                            </svg>
                        </a>
                        <ul id="category2" class="iq-submenu collapse" data-parent="#iq-sidebar-toggle">
                            <li class="">
                                <a href="/admin/nhan-vien/index">
                                    <i class="las la-minus"></i><span>Nhân viên</span>
                                </a>
                            </li>
                            <li class="">
                                <a href="/tai-khoan/index">
                                    <i class="las la-minus"></i><span>Khách hàng</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>
            <div class="p-3"></div>
        </div>
    </div>
    <div class="iq-top-navbar">
        <div class="iq-navbar-custom">
            <nav class="navbar navbar-expand-lg navbar-light p-0">
                <div class="iq-navbar-logo d-flex align-items-center justify-content-between">
                    <i class="ri-menu-line wrapper-menu"></i>
                    <a href="../backend/index.html" class="header-logo">
                        <img src="/api/read-file-by-img-url/Shoes6cop.png" class="img-fluid rounded-normal" alt="logo">
                        <h5 class="logo-title ml-3">SHOES 6</h5>

                    </a>
                </div>
                <div class="d-flex align-items-center">
                    <button class="navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-label="Toggle navigation">
                        <i class="ri-menu-3-line"></i>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav ml-auto navbar-list align-items-center">
                            <li class="nav-item nav-icon search-content">
                                <a href="#" class="search-toggle rounded" id="dropdownSearch" data-toggle="dropdown"
                                   aria-haspopup="true" aria-expanded="false">
                                    <i class="ri-search-line"></i>
                                </a>
                                <div class="iq-search-bar iq-sub-dropdown dropdown-menu"
                                     aria-labelledby="dropdownSearch">
                                    <form action="#" class="searchbox p-2">
                                        <div class="form-group mb-0 position-relative">
                                            <input type="text" class="text search-input font-size-12"
                                                   placeholder="type here to search...">
                                            <a href="#" class="search-link"><i class="las la-search"></i></a>
                                        </div>
                                    </form>
                                </div>
                            </li>
                            <li class="nav-item nav-icon dropdown caption-content">
                                <a href="#" class="search-toggle dropdown-toggle" id="dropdownMenuButton4"
                                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <img src="/api/read-file-by-id-tai-khoan/{{taiKhoan.id}}" class="img-fluid rounded" alt="user">
                                </a>
                                <div class="iq-sub-dropdown dropdown-menu" aria-labelledby="dropdownMenuButton">
                                    <div class="card shadow-none m-0">
                                        <div class="card-body p-0 text-center">
                                            <div class="media-body profile-detail text-center">
                                                <img src="/api/read-file-by-img-url/modern-sports-shoe-design-abstract-motion-generated-by-ai.jpg"
                                                     alt="profile-bg"
                                                     class="rounded-top img-fluid mb-4">
                                                <img src="/api/read-file-by-id-tai-khoan/{{taiKhoan.id}}" alt="profile-img"
                                                     class="rounded profile-img img-fluid avatar-70">
                                            </div>
                                            <div class="p-3">
                                                <h5 class="mb-1">{{taiKhoan.email}}</h5>
                                                <p class="mb-0">{{taiKhoan.hoVaTen}}</p>
                                                <div class="d-flex align-items-center justify-content-center mt-3">
                                                    <a href="/tai-khoan-quan-ly/ho-so" class="btn border mr-2">Thông
                                                        tin</a>
                                                    <a href="/logout" class="btn border">Đăng xuất</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </div>
    <div class="content-page">
        <div class="container-fluid">
            <div>
                <div class="row">
                    <div class="col-4">
                        <form id="formTaiKhoan" method="post" action="/api/uploadFile-detail-khach-hang" enctype="multipart/form-data">
                            <h4>Thông tin khách hàng</h4>
                            <hr>
                            <div class="container mt-5">
                                <div class=" mt-3 mb-3">
                                    <div class="crm-profile-img-edit position-relative">
                                        <img class="crm-profile-pic rounded avatar-100" ng-src="/api/read-file-khach-hang/{{taiKhoanRequest.id}}" id="profilePic"
                                             alt="Profile Picture">
                                        <div class="crm-p-image bg-primary">
                                            <i class="las la-pen upload-button"></i>
                                            <input class="file-upload" type="file" id="uploadProfilePic"
                                                   name="file" onchange="angular.element(this).scope().SelectFile(event)" accept="image/*">
                                        </div>
                                    </div>

                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Tên khách hàng</label>
                                    <input type="text" class="form-control" ng-model="taiKhoanRequest.tenKhachHang">
                                    <div class="text-danger" ng-if="kiemTra.tenKhachHang">
                                        Vui lòng nhập họ tên
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Số điện thoại</label>
                                    <input type="text" class="form-control" ng-model="taiKhoanRequest.sdt">
                                    <div class="text-danger" ng-if="kiemTra.sdt">
                                        Vui lòng nhập số điện thoại
                                    </div>
                                    <div class="text-danger" ng-if="dinhDang.sdt">
                                        Số điện thoại sai định dạng
                                    </div>
                                    <div class="text-danger" ng-if="checkTrung.sdt">
                                        Số điện thoại đã tồn tại
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">email</label>
                                    <input type="email" class="form-control" ng-model="taiKhoanRequest.email">
                                    <div class="text-danger" ng-if="kiemTra.email">
                                        Vui lòng nhập email
                                    </div>
                                    <div class="text-danger" ng-if="dinhDang.email">
                                        Email sai định dạng
                                    </div>
                                    <div class="text-danger" ng-if="checkTrung.email">
                                        Email đã tồn tại
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Ngày sinh</label>
                                    <input type="date" class="form-control" ng-model="taiKhoanRequest.ngaySinh">
                                    <div class="text-danger" ng-if="kiemTra.ngaySinh">
                                        Vui lòng chọn ngày sinh
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Giới tính</label><br>
                                    <div class="custom-control custom-radio custom-radio-color custom-control-inline">
                                        <input type="radio" name="gioiTinh" ng-value="1" id="nam"
                                               ng-model="taiKhoanRequest.gioiTinh" class="custom-control-input bg-primary">
                                        <label class="custom-control-label" for="nam">Nam</label>
                                    </div>
                                    <div class="custom-control custom-radio custom-radio-color custom-control-inline">
                                        <input type="radio" name="gioiTinh" ng-value="0" id="nu"
                                               ng-model="taiKhoanRequest.gioiTinh" class="custom-control-input bg-primary">
                                        <label class="custom-control-label" for="nu">Nữ</label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Trạng thái</label>
                                    <select ng-model="taiKhoanRequest.trangThai" class="form-control">
                                        <option ng-value="2" disabled selected>Chọn trạng thái</option>
                                        <option ng-value="1">Hoạt động</option>
                                        <option ng-value="0">Ngừng hoạt động</option>
                                    </select>
                                    <div class="text-danger" ng-if="kiemTra.trangThai">
                                        Vui lòng chọn trạng thái
                                    </div>
                                </div>
                                <div class="text-center mt-3 mb-5">
                                    <button ng-click="updateList()" type="button" class="btn btn-outline-success"
                                            style="width: 100px;">Cập nhật
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="col-8">
                        <div ng-repeat="diaChi in lstDc">
                            <div class="row">
                                <div class="col-12 col-lg-12 d-flex justify-content-between align-content-center">
                                    <div class="row">
                                        <div class="col-lg-12 col-12 d-flex justify-content-start">
                                            <h5>Địa chỉ {{(pageNumberDc * pageSize) + $index + 1}}</h5>
                                            <div ng-if="diaChi.macDinh == true" class="ml-3">
                                                <i class="bi bi-star-fill" style="color: darkorange"></i>
                                            </div>
                                            <div ng-if="diaChi.macDinh == false" style="color: black" class="ml-3">
                                                <i class="bi bi-star" ng-click="updateMacDinh(diaChi.id)" ></i>
                                            </div>
                                        </div>
                                    </div>
                                    <a ng-click="detailDiaChi(diaChi.id)" type="button"
                                       data-bs-toggle="modal"
                                       data-bs-target="#exampleModal2" class="badge bg-warning mr-2"
                                       data-toggle="tooltip" data-placement="top" title="" data-original-title="Cập nhật địa chỉ"
                                       href="#">
                                        <i class="bi bi-pencil-square"></i>
                                    </a>
                                </div>
                            </div>
                                <hr>
                                <!-- Tên khách hàng -->
                                <div class="row">
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label class="form-label">Tên</label>
                                            <input type="text" class="form-control" ng-model="diaChi.hoVaTen" disabled>
                                        </div>
                                    </div>
                                    <!-- Số điện thoại -->
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label class="form-label">Số điện thoại</label>
                                            <input type="text" class="form-control" ng-model="diaChi.soDienThoai" disabled>
                                        </div>
                                    </div>
                                </div>
                                <!-- Tỉnh/Thành -->
                                <div class="row">
                                    <div class="col-sm-4 mb-3">
                                        <div class="form-group">
                                            <label>Tỉnh/Thành</label>
                                            <select ng-model="diaChi.idTinh"
                                                    ng-change="selectTinhThanh(diaChi)" class="form-control" disabled>
                                                <option ng-value="0" disabled selected>Chọn Tỉnh/Thành</option>
                                                <option ng-value="diaChi.idTinh">
                                                    {{diaChi.tenTinh}}
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <!-- Quận/Huyện -->
                                    <div class="col-sm-4 mb-3">
                                        <div class="form-group">
                                            <label>Quận/Huyện</label>
                                            <select ng-model="diaChi.idHuyen"
                                                    ng-change="selectQuanHuyen(diaChi)" class="form-control" disabled>
                                                <option ng-value="0" disabled selected>Chọn Quận/Huyện</option>
                                                <option  ng-value="diaChi.idHuyen">
                                                    {{diaChi.tenHuyen}}
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <!-- Xã/Phường -->
                                    <div class="col-sm-4 mb-3">
                                        <div class="form-group">
                                            <label>Xã/Phường</label>
                                            <select ng-model="diaChi.idXa" class="form-control" disabled>
                                                <option value="0" disabled selected>Chọn Xã/Phường</option>
                                                <option ng-value="diaChi.idXa">
                                                    {{diaChi.tenXa}}
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <!-- Địa chỉ cụ thể -->
                                <div class="row">
                                    <div class="col-lg-12 col-12">
                                    <div class="form-group">
                                        <label >Địa chỉ cụ thể</label>
                                        <input disabled ng-model="diaChi.diaChiCuThe" type="text"
                                               placeholder="Ví dụ: Tòa nhà FPT Polytechnic, 13 phố Trịnh Văn Bô" class="form-control"
                                               ng-blur="checkDiaChi()"/>
                                    </div>
                                    </div>
                                </div>
                                <div class="d-flex">
                                    <div class="mb-3 me-2">

                                        <div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="exampleModalLabel2">Cập nhật địa chỉ</h5>
                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button>
                                                    </div>
                                                    <div class="modal-body">

                                                        <div class="row">
                                                            <div class="col-6">
                                                                <div class="mb-3">
                                                                    <label class="form-label">Tên khách hàng</label>
                                                                    <input type="text" class="form-control"
                                                                           ng-model="diaChiUpdate.tenKhachHang">
                                                                    <div class="text-danger" ng-if="kiemTra.tenKhachHangUpdate">
                                                                        Vui lòng nhập họ tên
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-6">
                                                                <div class="mb-3">
                                                                    <label class="form-label">Số điện thoại</label>
                                                                    <input type="text" class="form-control"
                                                                           ng-model="diaChiUpdate.sdt">
                                                                    <div class="text-danger" ng-if="kiemTra.sdtUpdate">
                                                                        Vui lòng nhập số điện thoại
                                                                    </div>
                                                                    <div class="text-danger" ng-if="dinhDang.sdtUpdate">
                                                                        Số điện thoại sai định dạng
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-sm-4 mb-3">
                                                                <div class="form-group">
                                                                    <label>Tỉnh/Thành</label>
                                                                    <select ng-model="diaChiUpdate.idTinh"
                                                                            ng-change="selectTinhThanhUpdate()" class="form-control">
                                                                        <option ng-value="0" disabled selected>Chọn Tỉnh/Thành</option>
                                                                        <option ng-repeat="item in listTinhThanh"
                                                                                ng-value="item.ProvinceID">
                                                                            {{item.ProvinceName}}
                                                                        </option>
                                                                    </select>
                                                                </div>
                                                                <div class="text-danger" ng-if="kiemTra.tinhUpdate">
                                                                    Vui lòng chọn tỉnh
                                                                </div>
                                                            </div>

                                                            <!-- Quận/Huyện -->
                                                            <div class="col-sm-4 mb-3">
                                                                <div class="form-group">
                                                                    <label>Quận/Huyện</label>
                                                                    <select ng-model="diaChiUpdate.idHuyen"
                                                                            ng-change="selectQuanHuyenUpdate()" class="form-control">
                                                                        <option ng-value="0" disabled selected>Chọn Quận/Huyện</option>
                                                                        <option ng-repeat="item in listQuanHuyen"
                                                                                ng-value="item.DistrictID">
                                                                            {{item.DistrictName}}
                                                                        </option>
                                                                    </select>
                                                                </div>
                                                                <div class="text-danger" ng-if="kiemTra.huyenUpdate">
                                                                    Vui lòng chọn huyện
                                                                </div>
                                                            </div>

                                                            <!-- Xã/Phường -->
                                                            <div class="col-sm-4 mb-3">
                                                                <div class="form-group">
                                                                    <label>Xã/Phường</label>
                                                                    <select ng-model="diaChiUpdate.idXa" class="form-control">
                                                                        <option value="0" disabled selected>Chọn Xã/Phường</option>
                                                                        <option ng-repeat="item in listXaPhuong"
                                                                                ng-value="item.WardCode">
                                                                            {{item.WardName}}
                                                                        </option>
                                                                    </select>
                                                                </div>
                                                                <div class="text-danger" ng-if="kiemTra.xaUpdate">
                                                                    Vui lòng chọn xã
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-12 mb-3">
                                                                <div class="form-group">
                                                                    <label >Địa chỉ cụ thể</label>
                                                                    <input ng-model="diaChiUpdate.diaChi" type="text"
                                                                           placeholder="Ví dụ: Tòa nhà FPT Polytechnic, 13 phố Trịnh Văn Bô"
                                                                           class="form-control"
                                                                           ng-blur="checkDiaChi()"/>
                                                                </div>
                                                                <div class="text-danger" ng-if="kiemTra.diaChiUpdate">
                                                                    Vui lòng nhập địa chỉ cụ thể
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                                                        <button type="button" class="btn btn-primary" ng-click="updateDiaChi(diaChiUpdate.id)">Lưu</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div ng-if="diaChi.macDinh == false">
                                        <a ng-click="deleteDiaChi(diaChi.id)" class="badge bg-danger mr-2"
                                           data-toggle="tooltip" data-placement="top" title="" data-original-title="Xóa địa chỉ"
                                           href="#"><i
                                                class="bi bi-trash3-fill"></i></a>
                                    </div>
                                </div>
                        </div>
                        <br>
                        <nav aria-label="Page navigation example">
                            <ul class="pagination justify-content-center">
                                <li class="page-item" ng-class="{disabled: pageNumberDc === 0}">
                                    <a class="page-link" href="#" ng-click="previousPageDc()">Previous</a>
                                </li>
                                <li class="page-item" ng-repeat="n in getPagesToDisplayDc()"
                                    ng-class="{active: n === pageNumberDc}">
                                    <a class="page-link" href="#" ng-click="setPageDc(n)">{{n + 1}}</a>
                                </li>
                                <li class="page-item" ng-class="{disabled: pageNumberDc === totalPagesDc - 1}">
                                    <a class="page-link" href="#" ng-click="nextPageDc()">Next</a>
                                </li>
                            </ul>
                        </nav>
                        <hr>
                        <button type="button" class="btn btn-outline-primary mb-5" data-toggle="modal" data-target="#exampleModal">
                            Thêm địa chỉ
                        </button>
                        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Thêm mới địa chỉ</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">

                                        <div class="row">
                                            <div class="col-6">
                                                <div class="mb-3">
                                                    <label class="form-label">Tên khách hàng</label>
                                                    <input type="text" class="form-control" ng-model="diaChiAdd.tenKhachHang">
                                                    <div class="text-danger" ng-if="kiemTra.tenKhachHangAdd">
                                                        Vui lòng nhập họ tên
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="mb-3">
                                                    <label class="form-label">Số điện thoại</label>
                                                    <input type="text" class="form-control" ng-model="diaChiAdd.sdt">
                                                    <div class="text-danger" ng-if="kiemTra.sdtAdd">
                                                        Vui lòng nhập số điện thoại
                                                    </div>
                                                    <div class="text-danger" ng-if="dinhDang.sdtAdd">
                                                        Số điện thoại sai định dạng
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-4 mb-3">
                                                <p class="mb-0">Tỉnh/Thành</p>
                                                <select ng-model="diaChiAdd.idTinh"
                                                        ng-change="selectTinhThanhAdd()" class="form-control">
                                                    <option ng-value="0" disabled selected>Chọn Tỉnh/Thành</option>
                                                    <option ng-repeat="item in listTinhThanh" ng-value="item.ProvinceID"
                                                            value="item.ProvinceID">
                                                        {{item.ProvinceName}}
                                                    </option>
                                                </select>
                                                <div class="text-danger" ng-if="kiemTra.tinhAdd">
                                                    Vui lòng chọn tỉnh
                                                </div>
                                            </div>

                                            <!-- Quận/Huyện -->
                                            <div class="col-sm-4 mb-3">
                                                <p class="mb-0">Quận/Huyện</p>
                                                <select ng-model="diaChiAdd.idHuyen"
                                                        ng-change="selectQuanHuyenAdd()" class="form-control">
                                                    <option ng-value="0" disabled selected>Chọn Quận/Huyện</option>
                                                    <option ng-repeat="item in listQuanHuyen" ng-value="item.DistrictID">
                                                        {{item.DistrictName}}
                                                    </option>
                                                </select>
                                                <div class="text-danger" ng-if="kiemTra.huyenAdd">
                                                    Vui lòng chọn huyện
                                                </div>
                                            </div>

                                            <!-- Xã/Phường -->
                                            <div class="col-sm-4 mb-3">
                                                <p class="mb-0">Xã/Phường</p>
                                                <select ng-model="diaChiAdd.idXa" class="form-control">
                                                    <option value="0" disabled selected>Chọn Xã/Phường</option>
                                                    <option ng-repeat="item in listXaPhuong" ng-value="item.WardCode">
                                                        {{item.WardName}}
                                                    </option>
                                                </select>
                                                <div class="text-danger" ng-if="kiemTra.xaAdd">
                                                    Vui lòng chọn xã
                                                </div>
                                            </div>

                                            <div class="col-sm-12 mb-3">
                                                <p class="mb-0">Địa chỉ cụ thể</p>
                                                <div class="form-outline">
                                                    <input ng-model="diaChiAdd.diaChi" type="text"
                                                           placeholder="Ví dụ: Tòa nhà FPT Polytechnic, 13 phố Trịnh Văn Bô"
                                                           class="form-control"
                                                           ng-blur="checkDiaChi()"/>
                                                </div>
                                                <div class="text-danger" ng-if="kiemTra.diaChiAdd">
                                                    Vui lòng nhập địa chỉ cụ thể
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                                        <button type="button" class="btn btn-primary" ng-click="addDiaChi()">Lưu</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Wrapper End-->
<footer class="iq-footer">
    <div class="container-fluid">
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-6">
                        <ul class="list-inline mb-0">
                            <li class="list-inline-item"><a href="#">Chính sách bảo mật</a></li>
                            <li class="list-inline-item"><a href="#">Điều khoản</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-6 text-right">
                        <span class="mr-1">2024©</span> <a href="#" class="">SHOES 6</a>.
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>
</body>
<script src="/assets/js/backend-bundle.min.js"></script>
<script src="/assets/js/table-treeview.js"></script>
<script src="/assets/js/customizer.js"></script>
<script async="" src="/assets/js/chart-custom.js"></script>
<script src="/assets/js/app.js"></script>
<script>
    const apiGetTinhThanh = "https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/province";
    const apiGetQuanHuyen = "https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/district";
    const apiGetXaPhuong = "https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/ward?district_id=";

    const apiDetailKhachHang = "/kh/tai-khoan/api/detail";
    const apiDetailDiaChi = "/kh/tai-khoan/api/detail-dia-chi";
    const apiUpdateKhachHang = "/kh/tai-khoan/api/update";
    const apiUpdateDiaChiMacDinh = "/kh/tai-khoan/api/update-dia-chi-mac-dinh";
    const apiAddDiaChi = "/kh/tai-khoan/api/add-dia-chi";
    const apiGetPageDiaChi = "/kh/tai-khoan/api/page-dia-chi";
    const apiDeleteDiaChi = "/kh/tai-khoan/api/deleteDc";
    const apiUpdateDcMacDinh="/kh/tai-khoan/api/update-mac-dinh"


    const token = "69ea89dc-44f2-11ef-8e53-0a00184fe694";
    const token2 = {"token": "69ea89dc-44f2-11ef-8e53-0a00184fe694"}
    let _idDiaChi = 0;
    let _idTaiKhoan = 0;


    let myApp = angular.module("myAngularJs", ['ngRoute']);
    myApp.controller("myController", myFunction);
    function myFunction($scope, $http, $window) {
        $http.get("/api/khach-hang/trang-chu/get-tai-khoan")
            .then(function (res) {
                if (res.status == 200) {
                    $scope.taiKhoan = res.data
                    if ($scope.taiKhoan == '') {
                        $scope.taiKhoan = null
                    }
                    return $scope.taiKhoan
                }
            })

        $scope.SelectFile = function (e) {
            document.getElementById("formTaiKhoan").submit();
        };
        // Load Tỉnh/Thành
        $scope.loadProvinces = function () {
            $http.get(apiGetTinhThanh, {headers: {"Token": token}})
                .then(function (response) {
                    $scope.listTinhThanh = response.data.data;
                })
                .catch(function (error) {
                    console.error('Error loading provinces:', error);
                });
        };

        // Load Quận/Huyện dựa trên Tỉnh/Thành đã chọn
        $scope.selectTinhThanh = function (diaChi) {
            if (diaChi && diaChi.idTinh) {
                return $http.get(`${apiGetQuanHuyen}?province_id=${diaChi.idTinh}`, {headers: {"Token": token}})
                    .then(function (response) {
                        $scope.listQuanHuyen = response.data.data;
                        diaChi.listQuanHuyen = response.data.data; // Lưu danh sách Quận/Huyện vào đối tượng diaChi
                    })
                    .catch(function (error) {
                        console.error('Error loading districts:', error);
                    });
            } else {
                return Promise.resolve(); // Trả về một Promise rỗng nếu không có idTinh
            }
        };

        $scope.selectQuanHuyen = function (diaChi) {
            if (diaChi && diaChi.idHuyen) {
                return $http.get(`${apiGetXaPhuong}${diaChi.idHuyen}`, {headers: {"Token": token}})
                    .then(function (response) {
                        $scope.listXaPhuong = response.data.data;
                        diaChi.listXaPhuong = response.data.data; // Lưu danh sách Xã/Phường vào đối tượng diaChi
                    })
                    .catch(function (error) {
                        console.error('Error loading wards:', error);
                    });
            } else {
                return Promise.resolve(); // Trả về một Promise rỗng nếu không có idHuyen
            }
        };

        // Khởi tạo bằng cách load danh sách Tỉnh/Thành
        $scope.loadProvinces();

        _idTaiKhoan = [[${id}]];
        $scope.getDetailKhachHang = function (){
            return $http.get(apiDetailKhachHang + "/" + _idTaiKhoan)
        }


        $scope.pageNumberDc = 0; // Trang hiện tại bắt đầu từ 0
        $scope.totalPagesDc = 0; // Tổng số trang
        $scope.pageSize = 2;
        $scope.pageRange = 2; // Số lượng trang sẽ hiển thị

        $scope.loadDiaChi = function (pageNumber) {
            let url = apiGetPageDiaChi + '?page=' + pageNumber + '&size=' + $scope.pageSize;

            $http.get(url).then(function (res) {
                if (res.status == 200) {
                    $scope.lstDc = res.data.content; // Lưu trữ dữ liệu địa chỉ trong lstDc
                    console.log($scope.lstDc)
                    console.log(url)
                    $scope.totalPagesDc = res.data.totalPages; // Tổng số trang
                    $scope.pageNumberDc = pageNumber; // Cập nhật trang hiện tại

                    for (let i = 0; i < $scope.lstDc.length; i++) {
                        $scope.abcxyz(i)
                    }
                } else {
                    console.error('Failed to load data');
                }
            }).catch(function (error) {
                console.error('Error fetching data:', error);
            });
        };

        $scope.getTinhThanh = () => {
            return $http.get(apiGetTinhThanh, {headers: token2})
        }

        $scope.getQuanHuyen = (tinhThanh) => {
            return $http.post(apiGetQuanHuyen, tinhThanh, {headers: token2})
        }

        $scope.getXaPhuong = (quanHuyen) => {
            return $http.get(apiGetXaPhuong + quanHuyen.DistrictID, {headers: token2})
        }

        $scope.abcxyz = (index) => {
            let obj = {"province_id": $scope.lstDc[index].idTinh}
            $scope.getTinhThanh()
                .then(function (res){
                    return res.data
                })
                .then(function (res){
                    let listTinhThanh = res.data
                    let tinhThanh = listTinhThanh.find(({ProvinceID}) => ProvinceID == $scope.lstDc[index].idTinh);
                    $scope.getQuanHuyen(obj)
                        .then(function (res) {
                            return res.data
                        })
                        .then(function (res) {
                            let listQuanHuyen = res.data
                            let quanHuyen = listQuanHuyen.find(({DistrictID}) => DistrictID == $scope.lstDc[index].idHuyen);
                            $scope.getXaPhuong(quanHuyen)
                                .then(function (res) {
                                    return res.data
                                })
                                .then(function (res) {
                                    let listXaPhuong = res.data
                                    let xaPhuong = listXaPhuong.find(({WardCode}) => WardCode == $scope.lstDc[index].idXa);
                                    $scope.lstDc[index].tenTinh = tinhThanh.ProvinceName
                                    $scope.lstDc[index].tenHuyen = quanHuyen.DistrictName
                                    $scope.lstDc[index].tenXa = xaPhuong.WardName
                                })
                        })
                })

        }

        $scope.getDetailKhachHang()
            .then(function (res){
                if (res.status == 200) {
                    $scope.taiKhoanRequest = {
                        id:res.data.id,
                        tenKhachHang: res.data.hoVaTen,
                        email: res.data.email,
                        sdt: res.data.soDienThoai,
                        ngaySinh: new Date(res.data.ngaySinh),
                        gioiTinh: parseInt(res.data.gioiTinh),
                        trangThai: parseInt(res.data.trangThai)
                    }
                }
            })
            .then(function (){
                $scope.loadDiaChi(0);
            })


        $scope.previousPageDc = function () {
            if ($scope.pageNumberDc > 0) {
                $scope.loadDiaChi($scope.pageNumberDc - 1);
            }
        };

        $scope.nextPageDc = function () {
            if ($scope.pageNumberDc < $scope.totalPagesDc - 1) {
                $scope.loadDiaChi($scope.pageNumberDc + 1);
            }
        };

        $scope.setPageDc = function (pageNumber) {
            $scope.loadDiaChi(pageNumber);
        };

        $scope.getPagesToDisplayDc = function () {
            let startPage = Math.max(0, $scope.pageNumberDc - Math.floor($scope.pageRange / 2));
            let endPage = Math.min($scope.totalPagesDc, startPage + $scope.pageRange);

            if (endPage - startPage < $scope.pageRange) {
                startPage = Math.max(0, endPage - $scope.pageRange);
            }

            return Array.from({length: endPage - startPage}, (v, i) => startPage + i);
        };


        $scope.updateList = function () {
            //Kiểm tra từng trường dữ liệu
            $scope.kiemTra = {
                tenKhachHang: false,
                sdt: false,
                email: false,
                ngaySinh: false,
                trangThai: false,
                gioiTinh: false
            };
            $scope.dinhDang = {
                email: false,
                sdt: false
            };
            //Tạo 1 biến để kiểm tra
            let flag = true;
            let checkMail = true;
            let checkSDT = true;
            if (!$scope.taiKhoanRequest || !$scope.taiKhoanRequest.tenKhachHang) {
                flag = false;
                $scope.kiemTra.tenKhachHang = true
            }
            if (!$scope.taiKhoanRequest || !$scope.taiKhoanRequest.ngaySinh) {
                flag = false;
                $scope.kiemTra.ngaySinh = true
            }
            if (!$scope.taiKhoanRequest || !$scope.taiKhoanRequest.email) {
                flag = false;
                $scope.kiemTra.email = true;
                checkMail = false
            }

            const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            if (checkMail && re.test($scope.taiKhoanRequest.email) == false) {
                flag = false;
                $scope.dinhDang.email = true;
            }

            if (!$scope.taiKhoanRequest || !$scope.taiKhoanRequest.sdt) {
                flag = false;
                $scope.kiemTra.sdt = true;
                checkSDT = false
            }
            var vnf_regex = /(84|0[3|5|7|8|9])+([0-9]{8})\b/g;
            if (checkSDT && vnf_regex.test($scope.taiKhoanRequest.sdt) == false) {
                flag = false;
                $scope.dinhDang.sdt = true;
            }

            $scope.checkTrung = {
                sdt: false,
                email: false
            }

            const apiCheckSdtUpdate = "/kh/tai-khoan/api/sdt-update";
            $http.get(apiCheckSdtUpdate + "?sdt=" + $scope.taiKhoanRequest.sdt + "&id=" + _idTaiKhoan).then(function (response) {
                if (response.status == 200) {
                    $scope.getSdt = response.data;
                    if ($scope.getSdt !== "") {
                        flag = false;
                        $scope.checkTrung.sdt = true
                    }
                }
            }).then(function (res){
                const apiCheckEmailUpdate = "/kh/tai-khoan/api/email-update";
                $http.get(apiCheckEmailUpdate + "?email=" + $scope.taiKhoanRequest.email + "&id=" + _idTaiKhoan).then(function (response) {
                    if (response.status == 200) {
                        $scope.getEmail = response.data;
                        if ($scope.getEmail !== "") {
                            flag = false;
                            $scope.checkTrung.email = true
                        }
                    }
                }).then(function (res){
                    if (flag) {

                        let newList = {
                            anh: $scope.taiKhoanRequest.anh,
                            tenKhachHang: $scope.taiKhoanRequest.tenKhachHang,
                            email: $scope.taiKhoanRequest.email,
                            soCanCuoc: "",
                            sdt: $scope.taiKhoanRequest.sdt,
                            ngaySinh: $scope.taiKhoanRequest.ngaySinh,
                            gioiTinh: $scope.taiKhoanRequest.gioiTinh,
                            idTinh: 1,
                            idHuyen: 1,
                            idXa: 1,
                            diaChi: "",
                            trangThai: $scope.taiKhoanRequest.trangThai
                        }

                        Swal.fire({
                            title: 'Bạn có muốn cập nhật thông tin khách hàng?',
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            confirmButtonText: 'Xác nhận',
                            cancelButtonText: 'Hủy'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                $http.put(
                                    apiUpdateKhachHang + "/" + _idTaiKhoan, // URL API
                                    newList // Dữ liệu gửi lên API
                                ).then(function (res) {
                                    if (res.status == 200) {
                                        Swal.fire(
                                            'Cập nhật thành công!',
                                            'Thông tin đã cập nhật thành công.',
                                            'success'
                                        ).then(() => {
                                            $window.location.href = "/tai-khoan/detail/" + _idTaiKhoan;
                                        }).catch(function (error) {
                                            console.error('Error:', error); // Xử lý lỗi nếu yêu cầu POST thất bại
                                        });
                                    }
                                });
                            }
                        });

                    }
                })
            })
        }

        $scope.updateDiaChi = function () {
            //Kiểm tra từng trường dữ liệu
            $scope.kiemTra = {
                tenKhachHangUpdate: false,
                sdtUpdate: false,
                tinhUpdate: false,
                huyenUpdate: false,
                xaUpdate: false,
                diaChiUpdate: false
            };
            $scope.dinhDang = {
                sdtUpdate: false
            };
            //Tạo 1 biến để kiểm tra
            let flag = true;
            let checkSDT = true;
            if (!$scope.diaChiUpdate || !$scope.diaChiUpdate.tenKhachHang) {
                flag = false;
                $scope.kiemTra.tenKhachHangUpdate = true
            }
            if (!$scope.diaChiUpdate || !$scope.diaChiUpdate.sdt) {
                flag = false;
                $scope.kiemTra.sdtUpdate = true
            }

            if (!$scope.diaChiUpdate || !$scope.diaChiUpdate.idTinh) {
                flag = false;
                $scope.kiemTra.tinhUpdate = true;
            }
            if (!$scope.diaChiUpdate || !$scope.diaChiUpdate.idHuyen) {
                flag = false;
                $scope.kiemTra.huyenUpdate = true;
            }
            if (!$scope.diaChiUpdate || !$scope.diaChiUpdate.idXa || $scope.diaChiUpdate.idXa == 0) {
                flag = false;
                $scope.kiemTra.xaUpdate = true;
            }
            if (!$scope.diaChiUpdate || !$scope.diaChiUpdate.diaChi) {
                flag = false;
                $scope.kiemTra.diaChiUpdate = true;
            }
            var vnf_regex = /(84|0[3|5|7|8|9])+([0-9]{8})\b/g;
            if (checkSDT && vnf_regex.test($scope.diaChiUpdate.sdt) == false) {
                flag = false;
                $scope.dinhDang.sdtUpdate = true;
            }

            if (flag) {

                let newList = {
                    hoVaTen: $scope.diaChiUpdate.tenKhachHang,
                    soDienThoai: $scope.diaChiUpdate.sdt,
                    idTinh: $scope.diaChiUpdate.idTinh,
                    idHuyen: $scope.diaChiUpdate.idHuyen,
                    idXa: $scope.diaChiUpdate.idXa,
                    diaChiCuThe: $scope.diaChiUpdate.diaChi,
                }
                Swal.fire({
                    title: 'Bạn có muốn cập nhật địa chỉ?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Xác nhận',
                    cancelButtonText: 'Hủy'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $http.put(
                            apiUpdateDiaChiMacDinh + "/" + _idDiaChi, // URL API
                            newList // Dữ liệu gửi lên API
                        ).then(function (res) {
                            if (res.status == 200) {
                                Swal.fire(
                                    'Cập nhật thành công!',
                                    'Địa chỉ đã cập nhật thành công.',
                                    'success'
                                ).then(() => {
                                    $window.location.href = "/tai-khoan/detail/" + _idTaiKhoan;
                                }).catch(function (error) {
                                    console.error('Error:', error); // Xử lý lỗi nếu yêu cầu POST thất bại
                                });
                            }
                        });
                    }
                });
            }
        }

        $scope.selectTinhThanhAdd = function () {
            if ($scope.diaChiAdd.idTinh) {
                $http.get(`${apiGetQuanHuyen}?province_id=${$scope.diaChiAdd.idTinh}`, {headers: {"Token": token}})
                    .then(function (response) {
                        $scope.listQuanHuyen = response.data.data;
                    })
                    .catch(function (error) {
                        console.error('Error loading districts:', error);
                    });
            } else {
                $scope.listQuanHuyen = [];
                $scope.listXaPhuong = [];
            }
        };

        $scope.selectQuanHuyenAdd = function () {
            if ($scope.diaChiAdd.idHuyen) {
                $http.get(`${apiGetXaPhuong}${$scope.diaChiAdd.idHuyen}`, {headers: {"Token": token}})
                    .then(function (response) {
                        $scope.listXaPhuong = response.data.data;
                    })
                    .catch(function (error) {
                        console.error('Error loading wards:', error);
                    });
            } else {
                $scope.listXaPhuong = [];
            }
        };

        $scope.addDiaChi = function () {
            //Kiểm tra từng trường dữ liệu
            $scope.kiemTra = {
                tenKhachHangAdd: false,
                sdtAdd: false,
                tinhAdd: false,
                huyenAdd: false,
                xaAdd: false,
                diaChiAdd: false,
            };
            $scope.dinhDang = {
                sdtAdd: false
            };
            //Tạo 1 biến để kiểm tra
            let flag = true;
            let checkSDT = true;
            if (!$scope.diaChiAdd || !$scope.diaChiAdd.tenKhachHang) {
                flag = false;
                $scope.kiemTra.tenKhachHangAdd = true
            }
            if (!$scope.diaChiAdd || !$scope.diaChiAdd.idTinh) {
                flag = false;
                $scope.kiemTra.tinhAdd = true;
            }
            if (!$scope.diaChiAdd || !$scope.diaChiAdd.idHuyen) {
                flag = false;
                $scope.kiemTra.huyenAdd = true;
            }
            if (!$scope.diaChiAdd || !$scope.diaChiAdd.idXa || $scope.diaChiAdd.idXa == 0) {
                flag = false;
                $scope.kiemTra.xaAdd = true;
            }
            if (!$scope.diaChiAdd || !$scope.diaChiAdd.diaChi) {
                flag = false;
                $scope.kiemTra.diaChiAdd = true;
            }

            if (!$scope.diaChiAdd || !$scope.diaChiAdd.sdt) {
                flag = false;
                $scope.kiemTra.sdtAdd = true;
                checkSDT = false
            }
            var vnf_regex = /(84|0[3|5|7|8|9])+([0-9]{8})\b/g;
            if (checkSDT && vnf_regex.test($scope.diaChiAdd.sdt) == false) {
                flag = false;
                $scope.dinhDang.sdtAdd = true;
            }

            if (flag) {

                let newList = {
                    id: null,
                    hoVaTen: $scope.diaChiAdd.tenKhachHang,
                    soDienThoai: $scope.diaChiAdd.sdt,
                    idTinh: $scope.diaChiAdd.idTinh,
                    idHuyen: $scope.diaChiAdd.idHuyen,
                    idXa: $scope.diaChiAdd.idXa,
                    diaChiCuThe: $scope.diaChiAdd.diaChi,
                    macDinh: null
                }
                Swal.fire({
                    title: 'Bạn có muốn thêm địa chỉ?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Xác nhận',
                    cancelButtonText: 'Hủy'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $http.post(
                            apiAddDiaChi, // URL API
                            newList // Dữ liệu gửi lên API
                        ).then(function (res) {
                            if (res.status == 200) {
                                Swal.fire(
                                    'Thêm thành công!',
                                    'Địa chỉ đã thêm thành công.',
                                    'success'
                                ).then(() => {
                                    $window.location.href = "/tai-khoan/detail/" + _idTaiKhoan;
                                    $window.location.reload();
                                }).catch(function (error) {
                                    console.error('Error:', error); // Xử lý lỗi nếu yêu cầu POST thất bại
                                });
                            }
                        });
                    }
                });

            }
        }

        // Load Quận/Huyện dựa trên Tỉnh/Thành đã chọn
        $scope.selectTinhThanhUpdate = function () {
            if ($scope.diaChiUpdate.idTinh) {
                $http.get(`${apiGetQuanHuyen}?province_id=${$scope.diaChiUpdate.idTinh}`, {headers: {"Token": token}})
                    .then(function (response) {
                        $scope.listQuanHuyen = response.data.data;
                    })
                    .catch(function (error) {
                        console.error('Error loading districts:', error);
                    });
            } else {
                $scope.listQuanHuyen = [];
                $scope.listXaPhuong = [];
            }
        };

        // Load Xã/Phường dựa trên Quận/Huyện đã chọn
        $scope.selectQuanHuyenUpdate = function () {
            if ($scope.diaChiUpdate.idHuyen) {
                $http.get(`${apiGetXaPhuong}${$scope.diaChiUpdate.idHuyen}`, {headers: {"Token": token}})
                    .then(function (response) {
                        $scope.listXaPhuong = response.data.data;
                    })
                    .catch(function (error) {
                        console.error('Error loading wards:', error);
                    });
            } else {
                $scope.listXaPhuong = [];
            }
        };

        // Khởi tạo bằng cách load danh sách Tỉnh/Thành
        $scope.loadProvinces();

        $scope.detailDiaChi = function (id) {
            _idDiaChi = id;
            $http.get(apiDetailDiaChi + "/" + id).then(function (res) {
                if (res.status == 200) {
                    $scope.diaChiUpdate = {
                        tenKhachHang: res.data.hoVaTen,
                        sdt: res.data.soDienThoai,
                        idTinh: res.data.idTinh,
                        idHuyen: res.data.idHuyen,
                        idXa: res.data.idXa,
                        diaChi: res.data.diaChiCuThe
                    };
                    // Mở modal sau khi cập nhật thông tin địa chỉ
                    $('#exampleModal2').modal('show');
                    $scope.selectTinhThanhUpdate();
                    $scope.selectQuanHuyenUpdate();
                } else {
                    console.error('Failed to load address details');
                }
            }).catch(function (error) {
                console.error('Error fetching address detail:', error);
            });
        };

        $scope.deleteDiaChi = function (id) {
            Swal.fire({
                title: 'Bạn có chắc chắn muốn xóa?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Xác nhận xóa',
                cancelButtonText: 'Hủy'
            }).then((result) => {
                if (result.isConfirmed) {
                    $http.delete(apiDeleteDiaChi + "/" + id).then(function (res) {
                        if (res.status == 200) {
                            Swal.fire(
                                'Đã xóa!',
                                'Địa chỉ đã được xóa thành công.',
                                'success'
                            ).then(() => {
                                $window.location.href = "/tai-khoan/detail/" + _idTaiKhoan;
                            });
                        }
                    });
                }
            });
        };

        $scope.updateMacDinh=function (idDc){
            Swal.fire({
                title: 'Bạn có muốn cập nhật địa chỉ mặc định?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Xác nhận',
                cancelButtonText: 'Hủy'
            }).then((result) => {
                if (result.isConfirmed) {
                    $http.get(apiUpdateDcMacDinh+"?idDc="+idDc).then(function (res) {
                        if (res.status == 200) {
                            Swal.fire(
                                'Cập nhật thành công!',
                                'Địa chỉ mặc định đã cập nhật thành công.',
                                'success'
                            ).then(() => {
                                $window.location.href = "/tai-khoan/detail/" + _idTaiKhoan;
                            });
                        }
                    });
                }
            });
        }
    }

    document.getElementById('uploadProfilePic').addEventListener('change', function (event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('profilePic').src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    });

    document.addEventListener('contextmenu', function(e) {
        e.preventDefault(); // Ngăn chuột phải
    });

    document.addEventListener('keydown', function(e) {
        if (e.keyCode === 123) {
            e.preventDefault();
        }
    });
</script>
</html>



















